{
  "name": "Daily ETL",
  "nodes": [
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "uG8gCQZ7rkAdczCmSvKCC",
          "mode": "list",
          "cachedResultUrl": "/workflow/uG8gCQZ7rkAdczCmSvKCC",
          "cachedResultName": "MBZ Artist Enrichment"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "name": "Call 'MBZ Artist Enrichment'",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1200,
        624
      ],
      "id": "a9e9e390-237d-4823-ae83-e3b53631a23d"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "JSwOOALUm8EQcFveF-kKw",
          "mode": "list",
          "cachedResultUrl": "/workflow/JSwOOALUm8EQcFveF-kKw",
          "cachedResultName": "Geography Coordinate Enrichment"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "name": "Call 'Geography Coordinate Enrichment'",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        2096,
        624
      ],
      "id": "ffd4f7e6-a417-4bc3-a920-f974e3e3fff0",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.update_mbids import UpdateMBIDsCLI\nreturn UpdateMBIDsCLI().execute()"
      },
      "name": "Update MBIDs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2320,
        624
      ],
      "id": "ebcb8fcf-0d9e-4e4d-8b29-653c87e93051",
      "executeOnce": true,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.run_dbt import RunDBTCLI\nreturn RunDBTCLI().execute(command='build')"
      },
      "name": "Run dbt Build",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2544,
        624
      ],
      "id": "d23405cc-00ae-4daa-ab5b-82d1f15c67b1",
      "executeOnce": true
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.discover_mbz_artists import DiscoverMBZArtistsCLI\nreturn DiscoverMBZArtistsCLI().execute()"
      },
      "name": "Discover MBZ Artists",
      "type": "n8n-nodes-base.code",
      "position": [
        976,
        624
      ],
      "typeVersion": 2,
      "id": "7dc3f86e-305a-4948-9d34-fd90aeb2c79b",
      "notes": "Identifies artists from tracks that need MusicBrainz lookup"
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.parse_mbz_data import ParseMBZDataCLI\nreturn ParseMBZDataCLI().execute()"
      },
      "name": "Parse MBZ Data",
      "type": "n8n-nodes-base.code",
      "position": [
        1424,
        624
      ],
      "typeVersion": 2,
      "id": "86ec7fab-a654-48f7-b0d1-9542f86385f2",
      "notes": "Processes cached MusicBrainz JSON files and writes to parquet tables"
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.process_mbz_hierarchy import ProcessMBZHierarchyCLI\nreturn ProcessMBZHierarchyCLI().execute()"
      },
      "name": "Process MBZ Hierarchy",
      "type": "n8n-nodes-base.code",
      "position": [
        1648,
        624
      ],
      "typeVersion": 2,
      "id": "b81b87e0-20e0-4f4e-aa8e-b00787ad5f94",
      "notes": "Processes MusicBrainz area hierarchy and builds parent relationships"
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_geography_base import EnrichGeographyBaseCLI\nreturn EnrichGeographyBaseCLI().execute()"
      },
      "name": "Enrich Geography Base",
      "type": "n8n-nodes-base.code",
      "position": [
        1872,
        624
      ],
      "typeVersion": 2,
      "id": "46f48316-6f02-4bcb-bcf0-6b320a69a4f9",
      "notes": "Adds continent information and geocoding parameters to area hierarchy"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 2
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        304,
        624
      ],
      "id": "ca28c528-6a27-44fa-a704-face0be944ae",
      "name": "Run Daily"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "W1j31on099RSbipqouRVm",
          "mode": "list",
          "cachedResultUrl": "/workflow/W1j31on099RSbipqouRVm",
          "cachedResultName": "Spotify Artist Enrichment"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        528,
        528
      ],
      "id": "5d22410b-075d-40f7-9a7a-b40abf28c5a4",
      "name": "Call 'Spotify Artist Enrichment",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "BZ_oK8XJlA4WMhQE9b6IB",
          "mode": "list",
          "cachedResultUrl": "/workflow/BZ_oK8XJlA4WMhQE9b6IB",
          "cachedResultName": "Spotify Album Enrichment"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        528,
        720
      ],
      "id": "270016fd-3745-406e-8605-f5870d7b2d65",
      "name": "Call 'Spotify Album Enrichment'"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        752,
        624
      ],
      "id": "32a1b83a-6109-45fd-9b51-477610a6e2fb",
      "name": "Merge Spotify Outputs"
    }
  ],
  "pinData": {},
  "connections": {
    "Call 'MBZ Artist Enrichment'": {
      "main": [
        [
          {
            "node": "Parse MBZ Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Geography Coordinate Enrichment'": {
      "main": [
        [
          {
            "node": "Update MBIDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update MBIDs": {
      "main": [
        [
          {
            "node": "Run dbt Build",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Discover MBZ Artists": {
      "main": [
        [
          {
            "node": "Call 'MBZ Artist Enrichment'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse MBZ Data": {
      "main": [
        [
          {
            "node": "Process MBZ Hierarchy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process MBZ Hierarchy": {
      "main": [
        [
          {
            "node": "Enrich Geography Base",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enrich Geography Base": {
      "main": [
        [
          {
            "node": "Call 'Geography Coordinate Enrichment'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Run Daily": {
      "main": [
        [
          {
            "node": "Call 'Spotify Album Enrichment'",
            "type": "main",
            "index": 0
          },
          {
            "node": "Call 'Spotify Artist Enrichment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Spotify Artist Enrichment": {
      "main": [
        [
          {
            "node": "Merge Spotify Outputs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Spotify Album Enrichment'": {
      "main": [
        [
          {
            "node": "Merge Spotify Outputs",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Spotify Outputs": {
      "main": [
        [
          {
            "node": "Discover MBZ Artists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "4e2d2372-b988-40f5-99d6-e14c5a48d123",
  "meta": {
    "instanceId": "fe0cdcb4af99c360c90455b1f1007a24ba2abc365db532c71df5662d52925885"
  },
  "id": "98lSkDAYkaO4Jcvc",
  "tags": []
}