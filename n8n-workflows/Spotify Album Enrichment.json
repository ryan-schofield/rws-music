{
  "name": "Spotify Album Enrichment",
  "nodes": [
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import ExtractAlbumGenresCLI\n\nalbum_data = _item[\"json\"][\"album_data\"]\n\nreturn ExtractAlbumGenresCLI().execute(album_data=album_data)"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        0
      ],
      "id": "2890ea17-42d4-4ba5-9bcc-623b033cdd18",
      "name": "Extract Album Genre"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import WriteAlbumDataCLI\n\nalbum_data = _item[\"json\"][\"data\"][\"album_data\"]\nalbum_out = WriteAlbumDataCLI().execute(album_data=album_data)\nalbum_out[\"album_data\"] = album_data\n\nreturn album_out "
      },
      "name": "Extract Album",
      "type": "n8n-nodes-base.code",
      "position": [
        0,
        0
      ],
      "typeVersion": 2,
      "id": "ce8ce976-50b8-4915-aeac-18866e042158",
      "retryOnFail": true,
      "maxTries": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import FetchAlbumBatchCLI\n\nbatch_index = _item[\"json\"][\"batch_index\"]\noffset = _item[\"json\"][\"offset\"]\nbatch_size = _item[\"json\"][\"size\"]\n\nreturn FetchAlbumBatchCLI().execute(\n    batch_index=batch_index,\n    offset=offset,\n    batch_size=batch_size\n)"
      },
      "name": "Fetch Album Batch",
      "type": "n8n-nodes-base.code",
      "position": [
        -224,
        0
      ],
      "typeVersion": 2,
      "id": "4218663e-757d-4b4f-be0e-f33498dd74ea"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data.batches",
        "options": {}
      },
      "name": "Split Into Batches",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -448,
        0
      ],
      "typeVersion": 1,
      "id": "1d231308-1393-4916-9634-1797e3c483c5"
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import IdentifyMissingAlbumsCLI\nreturn IdentifyMissingAlbumsCLI().execute(limit=25, batch_size=5)"
      },
      "name": "Identify Missing Albums",
      "type": "n8n-nodes-base.code",
      "position": [
        -672,
        0
      ],
      "typeVersion": 2,
      "id": "9822d8a9-c693-450d-a3c1-91d9a7211f1e",
      "notes": "Uses DuckDB to efficiently identify missing albums"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -896,
        0
      ],
      "id": "ef751acc-36fc-4387-bc9c-e45cb5271cd0",
      "name": "When Executed by Another Workflow"
    }
  ],
  "pinData": {},
  "connections": {
    "Fetch Album Batch": {
      "main": [
        [
          {
            "node": "Extract Album",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Into Batches": {
      "main": [
        [
          {
            "node": "Fetch Album Batch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Missing Albums": {
      "main": [
        [
          {
            "node": "Split Into Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Identify Missing Albums",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Album": {
      "main": [
        [
          {
            "node": "Extract Album Genre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "d5555c51-6dad-4096-a3a4-3d414424e0a7",
  "meta": {
    "instanceId": "03f02996677a6277d4986d4c62e9b1f4a2889034d3039e11223e4a810823d82a"
  },
  "id": "uHunxdb3D2leHWjVPOPA0",
  "tags": []
}