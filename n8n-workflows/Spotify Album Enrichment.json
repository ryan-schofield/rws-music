{
  "name": "Spotify Album Enrichment",
  "nodes": [
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import ExtractAlbumGenresCLI\n\nalbum_data = _item[\"json\"][\"data\"][\"album_data\"]\n\nreturn ExtractAlbumGenresCLI().execute(album_data=album_data)"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        896,
        192
      ],
      "id": "96867cde-2cb1-4dd4-ac07-d386b1c59333",
      "name": "Extract Album Genre"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import WriteAlbumDataCLI\n\nalbum_data = _item[\"json\"][\"data\"][\"album_data\"]\n\nreturn WriteAlbumDataCLI().execute(album_data=album_data)"
      },
      "name": "Extract Album",
      "type": "n8n-nodes-base.code",
      "position": [
        896,
        0
      ],
      "typeVersion": 2,
      "id": "097acd1d-3ed8-4e8c-a8c4-fb8135f49865"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import FetchAlbumBatchCLI\n\nbatch_index = _item[\"json\"][\"batch_index\"]\noffset = _item[\"json\"][\"offset\"]\nbatch_size = _item[\"json\"][\"size\"]\n\nreturn FetchAlbumBatchCLI().execute(\n    batch_index=batch_index,\n    offset=offset,\n    batch_size=batch_size\n)"
      },
      "name": "Fetch Album Batch",
      "type": "n8n-nodes-base.code",
      "position": [
        672,
        96
      ],
      "typeVersion": 2,
      "id": "529499b1-5d29-4a52-8067-512c232491ea"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data.batches",
        "options": {}
      },
      "name": "Split Into Batches",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        448,
        96
      ],
      "typeVersion": 1,
      "id": "b0d8ec52-812b-4784-b5d6-5ca24941e818"
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "from flows.cli.enrich_spotify_albums_granular import IdentifyMissingAlbumsCLI\nreturn IdentifyMissingAlbumsCLI().execute(limit=500, batch_size=20)"
      },
      "name": "Identify Missing Albums",
      "type": "n8n-nodes-base.code",
      "position": [
        224,
        96
      ],
      "typeVersion": 2,
      "id": "131640e7-87cc-4682-871b-78f09913980f",
      "notes": "Uses DuckDB to efficiently identify missing albums"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        96
      ],
      "id": "d7adb7d5-d182-4276-aadc-c3661bb9fcc9",
      "name": "When Executed by Another Workflow"
    }
  ],
  "pinData": {},
  "connections": {
    "Extract Album": {
      "main": [
        []
      ]
    },
    "Fetch Album Batch": {
      "main": [
        [
          {
            "node": "Extract Album",
            "type": "main",
            "index": 0
          },
          {
            "node": "Extract Album Genre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Into Batches": {
      "main": [
        [
          {
            "node": "Fetch Album Batch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Missing Albums": {
      "main": [
        [
          {
            "node": "Split Into Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Identify Missing Albums",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "22459930-9fdb-4b1c-8e8d-6af3b2c6f776",
  "meta": {
    "instanceId": "fe0cdcb4af99c360c90455b1f1007a24ba2abc365db532c71df5662d52925885"
  },
  "id": "BZ_oK8XJlA4WMhQE9b6IB",
  "tags": []
}